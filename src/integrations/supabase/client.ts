// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// Use environment variables with fallbacks for development
const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL || "";
const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || "";

// Validate environment variables
if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
  console.error('Missing Supabase environment variables. Make sure VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY are set.');
}

// Determine the current origin for redirects
const origin = typeof window !== 'undefined' ? window.location.origin : '';

// Configure the client
const options = {
  auth: {
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: true,
    flowType: 'pkce' as const,
  }
};

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_ANON_KEY, options);

// Helper for custom auth emails
export async function sendAuthEmail(email: string, type: 'signup' | 'reset' | 'magic_link', redirectUrl: string) {
  try {
    console.log(`Sending ${type} email to ${email}`);
    
    const response = await supabase.functions.invoke('resend-auth-email', {
      body: {
        email,
        type,
        redirectUrl: redirectUrl || `${origin}/auth?tab=signin`,
        meta: {
          origin
        }
      }
    });
    
    console.log('Custom auth email response:', response);
    
    // Check if there's a network error with the function invocation itself
    if (response.error) {
      console.error('Error from auth email function:', response.error);
      return {
        success: false,
        error: response.error.message || 'Failed to send authentication email'
      };
    }
    
    // Process the response from the function itself
    if (response.data?.success === false) {
      console.error('Auth email function returned an error:', response.data.error);
      return {
        success: false,
        error: response.data.error || 'Email service reported an error'
      };
    }
    
    return {
      success: true,
      data: response.data
    };
  } catch (error) {
    console.error('Error sending custom auth email:', error);
    return {
      success: false,
      error: error.message || 'Unexpected error sending authentication email'
    };
  }
}
